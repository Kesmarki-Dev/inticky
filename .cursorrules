# Cursor Rules - AgentInSec-AI Library & Ticketing System

## Projekt √Åttekint√©s
Ez egy Spring Boot alap√∫ ticketing rendszer, amely az AgentInSec-AI library-t haszn√°lja intelligens AI funkcionalit√°shoz. A rendszer c√©lja, hogy majdnem minden funkci√≥t az AI is el tudjon l√°tni.

## üê≥ Docker K√∂rnyezet Szab√°lyok

### KRITIKUS: Backend Docker Policy
- **MINDEN backend szolg√°ltat√°s CSAK Docker-ben futhat**
- **SOHA ne ind√≠ts backend szolg√°ltat√°sokat lok√°lisan Java-val**
- **Frontend (React) az EGYETLEN komponens, ami lok√°lisan fut**
- **Adatb√°zis, Redis, Kafka - mind Docker-ben**

### Docker Compose Haszn√°lat
```bash
# Backend szolg√°ltat√°sok ind√≠t√°sa
docker-compose up -d postgres redis kafka
docker-compose up --build user-service ticket-service tenant-service

# Frontend k√ºl√∂n (lok√°lisan)
cd frontend && npm run dev
```

### Fejleszt√©si Workflow
1. Backend v√°ltoztat√°s ‚Üí Docker rebuild sz√ºks√©ges
2. Frontend v√°ltoztat√°s ‚Üí csak lok√°lis restart
3. Adatb√°zis v√°ltoztat√°s ‚Üí Docker container restart
4. MINDIG Docker-ben tesztelj backend funkci√≥kat

## AgentInSec-AI Library Szab√°lyok

### 1. Library Alapok
- **Package**: `com.agentinsec:agentinsec-ai`
- **Verzi√≥**: 1.8.0
- **Java verzi√≥**: 17+
- **GitHub**: https://github.com/Kesmarki-Dev/agentinsec
- **Architekt√∫ra**: K√©tf√°zis√∫ AI Pipeline (Router AI + Agent AI)

### 2. K√©tf√°zis√∫ AI Pipeline Meg√©rt√©se
```
Felhaszn√°l√≥i k√©r√©s ‚Üí Router AI (Info Select + Func Select) ‚Üí Agent AI (V√°lasz gen. + Func exec) ‚Üí V√°lasz
```

**MINDIG haszn√°ld ezt a mint√°t:**
- Router AI kiv√°lasztja a relev√°ns info blokkokat √©s funkci√≥kat
- Agent AI gener√°lja a v√°laszt √©s v√©grehajtja a funkci√≥kat
- Soha ne pr√≥b√°lj k√∂zvetlen AI h√≠v√°sokat, mindig az AIChat oszt√°lyon kereszt√ºl

### 3. Inicializ√°l√°s Szab√°lyok

**PREFER√ÅLT m√≥dszer - Factory met√≥dusok:**
```java
// OpenAI - egyszer≈±
AIChat openAIChat = AIChatBuilder.forOpenAI("your-openai-api-key");

// Azure - k√ºl√∂n deployments
AIChat azureChat = AIChatBuilder.forAzure(
    "https://your-resource.openai.azure.com/",
    "your-azure-api-key",
    "gpt-router",      // Router deployment
    "gpt-agent",       // Agent deployment  
    "gpt-embedding"    // Embedding deployment
);

// Azure - k√∂z√∂s deployment
AIChat azureChatSimple = AIChatBuilder.forAzure(
    "https://your-resource.openai.azure.com/",
    "your-azure-api-key",
    "gpt-4"  // K√∂z√∂s deployment name
);
```

**KER√úLD a manu√°lis builder haszn√°lat√°t**, kiv√©ve speci√°lis konfigur√°ci√≥kn√°l.

### 4. Info Blokkok Szab√°lyok

**MINDIG haszn√°lj Builder pattern-t:**
```java
InfoBlock block = InfoBlock.builder()
    .id("unique_id")                    // K√ñTELEZ≈ê - egyedi azonos√≠t√≥
    .title("R√∂vid c√≠m")                // K√ñTELEZ≈ê - r√∂vid, le√≠r√≥ c√≠m
    .content("R√©szletes tartalom...")   // K√ñTELEZ≈ê - a t√©nyleges inform√°ci√≥
    .category("kateg√≥ria")              // AJ√ÅNLOTT - csoportos√≠t√°shoz
    .tag("tag1", "tag2")               // OPCION√ÅLIS - keres√©shez
    .shouldChunk(true)                 // Nagy sz√∂vegekhez (>500 karakter)
    .chunkSize(500)                    // Chunk m√©ret be√°ll√≠t√°sa
    .build();

aiChat.addInfoBlock(block);
```

**Info Block Best Practices:**
- Haszn√°lj besz√©des ID-kat: `ticket_workflow`, `user_management`, `priority_rules`
- Kategoriz√°lj logikusan: `workflow`, `rules`, `help`, `api`
- Nagy tartalmakat mindig chunk-olj (`shouldChunk(true)`)
- Egy info block egy t√©mak√∂rt fedjen le

### 5. Funkci√≥ Regisztr√°ci√≥ Szab√°lyok

**ToolBuilder haszn√°lata (1.6.0+) - PREFER√ÅLT:**
```java
aiChat.registerTool(
    ToolBuilder.create("function_name")
        .description("Pontos le√≠r√°s mit csin√°l")
        .category("kateg√≥ria")                          // Csoportos√≠t√°shoz
        .requiredString("param1", "Param√©ter le√≠r√°s")  // K√∂telez≈ë string param
        .optionalNumber("param2", "Opcion√°lis sz√°m", 0) // Opcion√°lis number param
        .requiredPermission("user")                     // Biztons√°gi szint
        .isDangerous(false)                            // Vesz√©lyes m≈±velet?
        .execute(params -> {
            // Lambda-based execution - EGYSZER≈∞ √©s TISZTA
            String param1 = params.get("param1").toString();
            return Map.of("result", processFunction(param1));
        })
);
```

**R√©gi FunctionDescriptor m√≥dszer - KER√úLD:**
```java
// NE haszn√°ld ezt, kiv√©ve speci√°lis esetekben
FunctionDescriptor func = FunctionDescriptor.builder()...
```

### 6. Chat Haszn√°lat Szab√°lyok

**Alapvet≈ë chat mint√°k:**
```java
// Egyszer≈± chat - session n√©lk√ºl
String response = aiChat.chat("Felhaszn√°l√≥i k√©rd√©s");

// Session alap√∫ chat - AJ√ÅNLOTT ticketing rendszerhez
String response = aiChat.chatInSession(sessionId, userId, "K√©rd√©s");

// Dinamikus context - speci√°lis esetekhez
List<InfoBlock> contextBlocks = loadTicketContext(ticketId);
String response = aiChat.chatWithContext(userId, "K√©rd√©s", contextBlocks);

// Router d√∂nt√©s k√∂vet√©se - debug c√©lokra
aiChat.chat("K√©rd√©s", (SelectedContext context) -> {
    log.debug("Kiv√°lasztott blokkok: " + context.getRelevantInfoBlockIds());
    log.debug("Kiv√°lasztott funkci√≥k: " + context.getRelevantFunctionNames());
});
```

### 7. Spring Boot Integr√°ci√≥ Szab√°lyok

**Service oszt√°ly minta:**
```java
@Service
public class AITicketService {
    private final AIChat aiChat;
    
    @Autowired
    public AITicketService(@Value("${agentinsec.api.key}") String apiKey) {
        this.aiChat = AIChatBuilder.forOpenAI(apiKey);
        initializeTicketingInfoBlocks();
        registerTicketingFunctions();
    }
    
    private void initializeTicketingInfoBlocks() {
        // Ticketing specifikus info blokkok
        aiChat.addInfoBlock(InfoBlock.builder()
            .id("ticket_workflow")
            .title("Ticket Workflow")
            .content("Ticket l√©trehoz√°s, m√≥dos√≠t√°s, lez√°r√°s folyamata...")
            .category("workflow")
            .build());
    }
    
    private void registerTicketingFunctions() {
        // Ticketing specifikus funkci√≥k
        aiChat.registerTool(
            ToolBuilder.create("create_ticket")
                .description("√öj ticket l√©trehoz√°sa")
                .category("ticket_management")
                .requiredString("title", "Ticket c√≠me")
                .requiredString("description", "Ticket le√≠r√°sa")
                .optionalString("priority", "Priorit√°s", "medium")
                .execute(params -> createTicket(params))
        );
    }
}
```

### 8. Biztons√°gi Szab√°lyok

**Jogosults√°g ellen≈ërz√©s:**
```java
// Permission checker be√°ll√≠t√°sa
DefaultPermissionChecker permissionChecker = new DefaultPermissionChecker();
permissionChecker.addPermission("user1", "admin");
permissionChecker.addPermission("user2", "user");

// Vesz√©lyes m≈±veletek meger≈ës√≠t√©se
DefaultConfirmationProvider confirmationProvider = new DefaultConfirmationProvider(
    (userId, action, reason) -> askUserConfirmation(userId, action, reason)
);

AIChat aiChat = AIChatBuilder.create()
    .withConfig(config)
    .withPermissionChecker(permissionChecker)
    .withConfirmationProvider(confirmationProvider)
    .build();
```

**Funkci√≥ biztons√°gi szintek:**
- `requiredPermission("user")` - alapfelhaszn√°l√≥
- `requiredPermission("admin")` - admin jogok
- `isDangerous(true)` - vesz√©lyes m≈±veletek (t√∂rl√©s, m√≥dos√≠t√°s)

### 9. Vector Store Szab√°lyok

**In-Memory (fejleszt√©s):**
```java
// Alap√©rtelmezett - automatikus
AIChat aiChat = AIChatBuilder.forOpenAI(apiKey);
```

**Qdrant (production):**
```java
VectorStore qdrantStore = new QdrantVectorStore(
    embeddingProvider,
    "http://localhost:6333",
    "ticketing_vectors"  // Collection n√©v
);

AIChat aiChat = AIChatBuilder.create()
    .withConfig(config)
    .withVectorStore(qdrantStore)
    .build();
```

### 10. Error Handling Szab√°lyok

**Library specifikus kiv√©telek:**
```java
try {
    String response = aiChat.chat(message);
} catch (AgentInSecException e) {
    log.error("AgentInSec hiba: " + e.getMessage());
    // Fallback logika
} catch (SecurityException e) {
    log.error("Biztons√°gi hiba: " + e.getMessage());
    // Jogosults√°g hi√°ny kezel√©se
}
```

### 11. Ticketing Rendszer Specifikus Szab√°lyok

**AI Funkci√≥k ticketing rendszerhez:**
- `create_ticket` - Ticket l√©trehoz√°s
- `update_ticket` - Ticket m√≥dos√≠t√°s
- `assign_ticket` - Ticket hozz√°rendel√©s
- `close_ticket` - Ticket lez√°r√°s
- `search_tickets` - Ticket keres√©s
- `get_ticket_status` - St√°tusz lek√©rdez√©s
- `add_comment` - Komment hozz√°ad√°s
- `escalate_ticket` - Eszkal√°ci√≥

**Info Blokkok ticketing rendszerhez:**
- `ticket_workflow` - Ticket folyamatok
- `priority_rules` - Priorit√°si szab√°lyok
- `sla_policies` - SLA szab√°lyzatok
- `user_permissions` - Felhaszn√°l√≥i jogok
- `escalation_matrix` - Eszkal√°ci√≥s m√°trix

### 12. Konfigur√°ci√≥s Szab√°lyok

**application.yml be√°ll√≠t√°sok:**
```yaml
agentinsec:
  api-key: ${AGENTINSEC_API_KEY:demo-key}
  provider: openai  # vagy azure
  azure:
    endpoint: ${AZURE_OPENAI_ENDPOINT:}
    router-deployment: gpt-router
    agent-deployment: gpt-agent
    embedding-deployment: gpt-embedding
  vector-store:
    type: memory  # vagy qdrant
    qdrant:
      url: http://localhost:6333
      collection: ticketing_vectors
```

### 13. Tesztel√©si Szab√°lyok

**Unit tesztek:**
```java
@Test
void testTicketCreation() {
    // Mock AIChat
    AIChat mockAIChat = Mockito.mock(AIChat.class);
    when(mockAIChat.chat(anyString())).thenReturn("Ticket l√©trehozva");
    
    // Test logic
}
```

**Integr√°ci√≥s tesztek:**
```java
@SpringBootTest
class AITicketServiceIntegrationTest {
    @Autowired
    private AITicketService aiTicketService;
    
    @Test
    void testRealAIIntegration() {
        // Val√≥di AI h√≠v√°s tesztel√©se
    }
}
```

### 14. Performance √©s Optimaliz√°l√°s

**Thread Safety:**
- AIChat thread-safe, t√∂bbsz√°l√∫ haszn√°lat OK
- AsyncAIChat haszn√°lata nagy terhel√©shez

**Caching:**
- Info blokkok cache-el√©se automatikus
- Vector store cache-el√©s be√©p√≠tett

**Connection Pooling:**
- HTTP connection pooling automatikus
- Azure SDK m√≥d aj√°nlott production-ben

### 15. Gyakori Hib√°k Elker√ºl√©se

**NE csin√°ld:**
- K√∂zvetlen AI API h√≠v√°sok (mindig AIChat-en kereszt√ºl)
- Info blokkok n√©lk√ºli funkci√≥ regisztr√°ci√≥
- Biztons√°gi ellen≈ërz√©sek kihagy√°sa
- Nagy info blokkok chunking n√©lk√ºl

**MINDIG csin√°ld:**
- Factory met√≥dusok haszn√°lata inicializ√°l√°shoz
- ToolBuilder haszn√°lata funkci√≥khoz
- Session alap√∫ chat ticketing rendszerben
- Proper error handling

### 16. Fejleszt√©si Workflow

1. **Info blokkok defini√°l√°sa** - Mi kell az AI-nak tudnia?
2. **Funkci√≥k regisztr√°l√°sa** - Mit tud csin√°lni az AI?
3. **Chat integr√°ci√≥** - Hogyan kommunik√°l a felhaszn√°l√≥?
4. **Tesztel√©s** - M≈±k√∂dik minden funkci√≥?
5. **Optimaliz√°l√°s** - Performance √©s biztons√°g OK?

---

## Ticketing Rendszer Specifikus Ir√°nyelvek

### AI-First Approach
- Minden funkci√≥ legyen el√©rhet≈ë AI-n kereszt√ºl is
- Natural language interface minden m≈±velethez
- AI seg√≠tsen a ticket kategoriz√°l√°sban √©s priorit√°sban
- Automatikus v√°lasz javaslatok

### User Experience
- Chat interface legyen az els≈ëdleges
- Hagyom√°nyos UI legyen backup
- AI context legyen ticket-specifikus
- Session management ticket alapon

Ez a szab√°lyrendszer biztos√≠tja az AgentInSec-AI library helyes haszn√°lat√°t a ticketing rendszerben.
