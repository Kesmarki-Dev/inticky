server:
  port: 8084

spring:
  application:
    name: ai-service
  
  datasource:
    url: jdbc:postgresql://localhost:5432/inticky_ai
    username: ${DB_USERNAME:inticky_user}
    password: ${DB_PASSWORD:inticky_pass}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 300000
      connection-timeout: 20000
      leak-detection-threshold: 60000

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true

  cache:
    type: redis
    redis:
      time-to-live: 3600000 # 1 hour
    cache-names:
      - ai-sessions
      - ai-responses
      - info-blocks
      - function-registry

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: 1
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${JWT_ISSUER_URI:http://localhost:8080}

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

# Logging
logging:
  level:
    com.kesmarki.inticky: DEBUG
    com.agentinsec: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# OpenAPI Documentation
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method

# AgentInSec-AI Configuration
agentinsec:
  ai:
    # OpenAI Configuration
    openai:
      api-key: ${AGENTINSEC_OPENAI_API_KEY:demo-key}
      model: ${AGENTINSEC_OPENAI_MODEL:gpt-4}
      max-tokens: 2000
      temperature: 0.7
    
    # Azure OpenAI Configuration (alternative)
    azure:
      enabled: ${AGENTINSEC_AZURE_ENABLED:false}
      endpoint: ${AGENTINSEC_AZURE_ENDPOINT:}
      api-key: ${AGENTINSEC_AZURE_API_KEY:}
      router-deployment: ${AGENTINSEC_AZURE_ROUTER_DEPLOYMENT:gpt-router}
      agent-deployment: ${AGENTINSEC_AZURE_AGENT_DEPLOYMENT:gpt-agent}
      embedding-deployment: ${AGENTINSEC_AZURE_EMBEDDING_DEPLOYMENT:gpt-embedding}
    
    # Vector Store Configuration
    vector-store:
      type: ${AGENTINSEC_VECTOR_STORE_TYPE:in-memory} # in-memory or qdrant
      qdrant:
        host: ${AGENTINSEC_QDRANT_HOST:localhost}
        port: ${AGENTINSEC_QDRANT_PORT:6333}
        collection-name: ${AGENTINSEC_QDRANT_COLLECTION:inticky_vectors}
        use-https: ${AGENTINSEC_QDRANT_HTTPS:false}
        api-key: ${AGENTINSEC_QDRANT_API_KEY:}
    
    # Session Configuration
    session:
      timeout-minutes: 60
      max-sessions-per-user: 5
      cleanup-interval-minutes: 30
    
    # Security Configuration
    security:
      enable-permission-checking: true
      enable-confirmation-provider: true
      dangerous-operations-require-confirmation: true

# Application specific configuration
inticky:
  ai:
    # Ticket Analysis Configuration
    ticket-analysis:
      enabled: true
      auto-categorize: true
      auto-prioritize: true
      suggest-assignee: true
      extract-keywords: true
    
    # Natural Language Processing
    nlp:
      sentiment-analysis: true
      language-detection: true
      keyword-extraction: true
      entity-recognition: true
    
    # AI Chat Configuration
    chat:
      max-message-length: 4000
      max-history-length: 50
      enable-context-memory: true
      enable-function-calling: true
    
    # Integration Configuration
    integration:
      ticket-service:
        url: ${TICKET_SERVICE_URL:http://ticket-service:8083}
        timeout: 30s
      user-service:
        url: ${USER_SERVICE_URL:http://user-service:8082}
        timeout: 10s
      notification-service:
        url: ${NOTIFICATION_SERVICE_URL:http://notification-service:8085}
        timeout: 15s
    
    # Performance Configuration
    performance:
      async-processing: true
      batch-size: 10
      thread-pool-size: 5
      queue-capacity: 100
    
    # Rate Limiting
    rate-limit:
      requests-per-minute: 30
      requests-per-hour: 500
      burst-capacity: 10
